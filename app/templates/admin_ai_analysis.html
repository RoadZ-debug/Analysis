{% extends "base.html" %}

{% block content %}
<div class="layui-card">
    <div class="layui-card-header">
        <h2>AI 数据清洗分析管理</h2>
    </div>
    <div class="layui-card-body">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="layui-panel" style="padding: 20px; background-color: #f8f9fa;">
                    <h3><i class="layui-icon layui-icon-engine"></i> 智能分析控制台</h3>
                    <p style="color: #666; margin-top: 10px;">
                        在此处输入您的自然语言指令，AI 将自动分析并操作数据库进行清洗或查询。
                    </p>
                    
                    <form class="layui-form" style="margin-top: 20px;">
                        <div class="layui-form-item">
                            <div class="layui-input-block" style="margin-left: 0;">
                                <textarea name="instruction" placeholder="请输入指令，例如：'统计最近采集的新闻数量' 或 '删除标题为空的数据'" class="layui-textarea" rows="4"></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <button class="layui-btn layui-btn-normal layui-btn-fluid" lay-submit lay-filter="ai-execute">
                                <i class="layui-icon layui-icon-play"></i> 执行指令
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <hr>

        <div class="layui-row">
            <div class="layui-col-md12">
                <h3>执行结果 / 对话记录</h3>
                <div id="chat-history" style="border: 1px solid #e6e6e6; padding: 15px; height: 400px; overflow-y: auto; margin-top: 15px; background: white;">
                    <div class="system-msg" style="text-align: center; color: #999;">
                        <p>等待指令...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
layui.use(['form', 'layer', 'jquery'], function(){
    var form = layui.form;
    var layer = layui.layer;
    var $ = layui.jquery;
    
    form.on('submit(ai-execute)', function(data){
        var instruction = data.field.instruction;
        if(!instruction){
            layer.msg('请输入指令');
            return false;
        }
        
        // Add user message
        $('#chat-history').append('<div style="margin: 10px 0; text-align: right;"><span style="background: #009688; color: white; padding: 8px 12px; border-radius: 4px; display: inline-block;">' + instruction + '</span></div>');
        $('#chat-history').scrollTop($('#chat-history')[0].scrollHeight);
        
        // Loading
        var loading = layer.load(1);
        
        // TODO: Integrate with backend API (mock for now as per demo stage)
        // In real implementation, this would call the route that invokes the LLM
        setTimeout(function(){
            layer.close(loading);
            var mockResponse = "Demo Mode: Received instruction '" + instruction + "'. Analysis module pending integration.";
            
            $('#chat-history').append('<div style="margin: 10px 0; text-align: left;"><div style="background: #f2f2f2; padding: 10px; border-radius: 4px; display: inline-block; max-width: 80%;"><p><strong>AI Assistant:</strong></p><p>' + mockResponse + '</p></div></div>');
            $('#chat-history').scrollTop($('#chat-history')[0].scrollHeight);
            
        }, 1000);
        
        return false;
    });
});
</script>
{% endblock %}